# Digital Forensic Report

## Authors 

<p align="justify"> 
	
	‚Ä¢ Andr√© Proen√ßa ‚Ä¢ Ana Albuquerque ‚Ä¢ Joel Russo
</p>

---

## Appendix

- Digital Forensics Report;
- Estrutura da investiga√ß√£o;
- Artefatos de evid√™ncia;
- Ferramentas externas usadas para obter as provas;
- Provas descobertas;
- Procedimentos para a obten√ß√£o das provas descobertas;
- Itens auxiliares;
- Automatiza√ß√£o de extra√ß√£o de provas e inspe√ß√£o de ficheiros;

---

## Digital Forensics Report



**1. Do you find any traces of the documents that Mr. Daniels claims to have in his possession? Present your findings explaining the procedure you followed to retrieve these documents.**

> <p align="justify"> 
> Atrav√©s da an√°lise realizada, adquirimos todas as 5 (cinco) provas que estavam escondidas. Das 5 (cinco) provas, apenas 3 (tr√™s) comprovam que de facto houve transfer√™ncia de dinheiro.</p>
> </p>
> <p align="justify"> 
> O ‚ÄúClub Statement‚Äù, um ficheiro pdf que estava escondido na imagem ticket.jpg (obtido usado a ferramenta foremost) que evidencia que houve um acordo quando efetuada a transfer√™ncia de 72,000,000‚Ç¨ (setenta e dois milh√µes de euros) ao clube. √â de elevada import√¢ncia reter que o Sr.Velucci assinou este documento mesmo tendo a dire√ß√£o relevado um enorme desagrado.
> </p>
> <p align="justify"> 
> Nos ficheiros hbfs.wav e chants1.wav estavam escondidas a quarta (4¬™) e quinta (5¬™) pistas descobertas: 2 ficheiros pdf. O primeiro descreve um extrato banc√°rio em como no dia 09/06/2021 Levy Fran Velucci transferiu 3 milh√µes de euros para a sua conta banc√°ria. O segundo √© uma declara√ß√£o em como o presidente do grupo The Red Hawks FC n√£o concorda com a transfer√™ncia do jogador. Este menciona a presta√ß√£o de James Santos e relembra como este influencia positivamente o clube,
> </p>
> <p align="justify"> 
> Os detalhes √† cerca das ferramentas usadas para obten√ß√£o das provas, as provas descobertas e os procedimentos para a obten√ß√£o das mesmas, podem ser encontradas no relat√≥rio nas respetivas sec√ß√µes. (Ver ap√™ndice)
> </p>    
> Podemos ent√£o concluir que o Mr. Daniels tem em sua posse documentos que provam que houve desvio de dinheiro.
> </p>

#

**2.	In case you found any relevant documents, what can you learn from them at this point? Do they support the original hypothesis of Mr. Velucci's fraudulent actions put forth by Mr. Daniels?**
> <p align="justify"> 
> Embora nem todas as evid√™ncias provem que efetivamente houve desvio de dinheiro, todas as evidencias que encontr√°mos s√£o relevantes. Conseguimos obter atrav√©s do ficheiro daft_punk.gif o ficheiro James_Santos_profile.pdf que ilustra o perfil do jogador. Este mostra os detalhes da Premiere League Record, os Honours & Howards tanto da Young Player of the Season como da Premiere League Champion. Descobrimos ainda um documento confidencial cujo t√≠tulo √© ‚ÄúInternal Comunication‚Äù que afirma que o jogador influencia positivamente o clube e que talvez o valor de pagamento duplique dentro de 3 a 6 meses. Descobriu-se tamb√©m que a password do ficheiro chants.zip √© ‚ÄúWichita‚Äù. 
> </p>
> <p align="justify"> 
> Ao interpretar os ficheiros pdf obtidos com um script conclu√≠mos que o presidente do grupo The Red Hawks FC n√£o pretendia que o jogador sa√≠sse do clube, devido √† sua grandiosa presta√ß√£o, e que houve efetivamente desvio de dinheiro (como pode ser comprovado pelo extrato banc√°rio). O ‚ÄúClub Statement‚Äù, um ficheiro pdf que estava escondido na imagem ticket.jpg, evidencia que houve um acordo quando foi efetuada a transfer√™ncia de 72,000,000‚Ç¨ (setenta e dois milh√µes de euros) ao clube. Significa que o presidente do clube assinou este documento, mesmo ap√≥s a discord√¢ncia de membros superiores da organiza√ß√£o. 
> </p>
> <p align="justify"> 
> Em suma, as √∫ltimas 3 (tr√™s) provas, ‚ÄúClub Statement‚Äù, ‚ÄúSTATEMENT OF ACCOUNT‚Äù e ‚ÄúOfficial Supporters Statement‚Äù, suportam a hip√≥tese original de que houve ind√≠cios de a√ß√µes fraudulentas.
> </p>

#
              
**3.	From the analysis of all provided artifacts, what else have you learned? Present every interesting insight you may have gained, e.g., about the potential identity of involved stakeholders, sources of leakage, skill level of the individuals responsible for the leakage, etc.**

> <p align="justify"> 
> Tendo em conta todas as pistas que encontramos √© poss√≠vel retirar algumas conclus√µes sobre o que aprendemos. Exercit√°mos t√©cnicas de esteganografia que consiste em ocultar a exist√™ncia de uma mensagem dentro de outra, desenvolvemos compet√™ncias no que toca √† interpreta√ß√£o perante a exist√™ncia de v√°rias provas nomeadamente qual a rela√ß√£o entre as mesmas, quais relevam efetivamente ind√≠cios de crime. Felizmente, o investigador Charles Daniels alegou e publicou no seu blogue a sua suspeita de que Sr.Velucci estava envolvido em a√ß√µes fraudulentas. Devido √† perspic√°cia deste investigador foi-nos poss√≠vel ter acesso √† sua pen drive e consequentemente ter acesso a todas as evidencias mencionadas em respostas anteriores. Os crimes deste tipo de a√ß√µes s√£o bastante frequentes, especialmente quando se trata de jogadores bastante bem qualificados como √© o caso do jogador James Santos. </p>
> <p align="justify">  
> Podemos analisar com mais detalhe a estrat√©gia do presidente do clube: este tentou, ilegalmente, com que o jogador fosse transferido para outro clube, ocultando a declara√ß√£o que demonstra a satisfa√ß√£o com a presta√ß√£o do jogador e o descontentamento com a aceita√ß√£o da transfer√™ncia do mesmo. Satisfatoriamente, nesta carta direcionada ao Sr.Velucci, √© poss√≠vel comprovar que a empresa ir√° lutar pelos seu direitos e n√£o deixar que a gan√¢ncia prevale√ßa em detrimento do ato correto.
> </p>

#

**4.	Based on your findings, suggest the next steps you would take to pursue this investigation.**
> <p align="justify"> 
> Comprovada a exist√™ncia de documentos incriminadores do Sr.Velucci, √© agora necess√°rio investigar a veracidade dos mesmos. Por exemplo, investigando diretamente o Sr.Velluci, obtendo um mandato de um juiz caso este concorde que as provas obtidas s√£o suficientes para que se proceda com o processo. Numa tentativa de obter mais evid√™ncias, seria uma boa ideia  procurar tamb√©m provas de pessoas em redor do presidente. Uma vez que ainda nos encontramos numa fase inicial da investiga√ß√£o e tendo obtido recentemente os documentos referidos pelo Sr.Daniels √© ainda muito cedo para incriminar o Sr.Velluci. Por estes motivos achamos que a investiga√ß√£o deve continuar.
> </p>
                
---

## Estrutura da investiga√ß√£o

Organiz√°mos a investiga√ß√£o por diretorias. 
Todas as provas descobertas s√£o guardadas na diretoria `Evidences/`.
Todas as ferramentas usadas para a descobertas de provas (scripts, programas, etc...) s√£o guardadas na diretoria `Tools/`.

**Visualiza√ß√£o gr√°fica do ambiente de investiga√ß√£o:**[^1]

        
```
csf-lab1-artifacts
       ‚îî‚îÄ‚îÄ‚îÄ Evidences
		‚îî‚îÄ‚îÄ‚îÄ HexdumpFiles (Opcional, se correr o comando inspectFiles.sh)
			‚îî‚îÄ‚îÄ‚îÄ *_hexdump.txt 

		‚îî‚îÄ‚îÄ‚îÄ StringFiles (Opcional, se correr o comando inspectFiles.sh)
			‚îî‚îÄ‚îÄ‚îÄ *_Strings.txt 

		‚îî‚îÄ‚îÄ‚îÄ club_statement.pdf
		‚îî‚îÄ‚îÄ‚îÄ chant1.wav
		‚îî‚îÄ‚îÄ‚îÄ internal_comunication.pdf
		‚îî‚îÄ‚îÄ‚îÄ chantsZipPassword.txt
		‚îî‚îÄ‚îÄ‚îÄ James_Santos_profile.pdf
		‚îî‚îÄ‚îÄ‚îÄ hbfs-lsb2-2.txt
		‚îî‚îÄ‚îÄ‚îÄ chant1-lsb2-4.txt
		‚îî‚îÄ‚îÄ‚îÄ statement_of_account.pdf	  
		‚îî‚îÄ‚îÄ‚îÄ official_supporters_statement.pdf		

	‚îî‚îÄ‚îÄ‚îÄ Tools
		‚îî‚îÄ‚îÄ‚îÄ generateEvidences.sh
		‚îî‚îÄ‚îÄ‚îÄ inspectFiles.sh
		‚îî‚îÄ‚îÄ‚îÄ hbfsRecover.sh
		‚îî‚îÄ‚îÄ‚îÄ chants1Recover.sh
		‚îî‚îÄ‚îÄ‚îÄ crackChantsZip.py
		‚îî‚îÄ‚îÄ‚îÄ recoverWav.py
		‚îî‚îÄ‚îÄ‚îÄ SNA_Lyrics_words.txt
		‚îî‚îÄ‚îÄ‚îÄ words.txt
		‚îî‚îÄ‚îÄ‚îÄ tool
		‚îî‚îÄ‚îÄ‚îÄ tool.py

	Nota: N√£o est√£o inclu√≠dos no zip. 
	      Devem ser inclu√≠dos para correr os ficheiros de automatiza√ß√£o

	‚îî‚îÄ‚îÄ‚îÄ chants.zip
	‚îî‚îÄ‚îÄ‚îÄ daft_punk.gif
	‚îî‚îÄ‚îÄ‚îÄ discovery.jpg
	‚îî‚îÄ‚îÄ‚îÄ hbfs.wav
	‚îî‚îÄ‚îÄ‚îÄ homework.jpg
	‚îî‚îÄ‚îÄ‚îÄ ram.jpg
	‚îî‚îÄ‚îÄ‚îÄ SNA_Football_Lyrics.mp4
	‚îî‚îÄ‚îÄ‚îÄ ticket.jpg
```        
[^1]: O caractere * representa cada um dos ficheiros dados.

---

## Artefatos de evid√™ncia

| Artefacto                        | MD5                              | Descri√ß√£o
|:--------------------------------:|:--------------------------------:|:--------------------------------:
|club_statement.pdf                | e02839232a2283ac0843de8ecfc980a0 | pdf extra√≠do de ticket.jpg
|chant1.wav                        | 91a0fa4cf25edf1365a3cfece6bbf586 | wav extra√≠do de chants.zip
|internal_comunication.pdf         | 50066842298a5d1e434e37dee372a48a | pdf extra√≠do de chants.zip
|chantsZipPassword.txt             | bd38890d51f93f852bd86af2c59b8fe9 | password crakeada de chants.zip
|James_Santos_profile.pdf          | 44d015d11ecd0ec4ecaa6cb350032d17 | pdf extra√≠do de daft_punk.gif
|statement_of_account.pdf          | 2be65457105ca324381952538fc94de7 | pdf extra√≠do chant1.wav
|official_supporters_statement.pdf | 33bd1f8ed5f5692c5bf1e5a87d6110b2 | pdf extra√≠do de hbfs.wav

---

## Ferramentas externas usadas para obter as provas

‚Ä¢ `foremost` ‚Ä¢ `exiftool` ‚Ä¢ `fcrackzip` ‚Ä¢ `tool` ‚Ä¢ `strings` ‚Ä¢ `hexdump` ‚Ä¢ `decompile3` ‚Ä¢


---

## Provas descobertas

`5/5` segredos encontrados

| Ficheiros Dados | Segredo
|:---------------:|:---------------------------------------:
|ticket.jpg       | club_statement.pdf    
|daft_punk.gif    | James_Santos_profile.pdf
|chants.zip       | internal_comunication.pdf, chant1.wav
|hbfs.wav         | official_supporters_statement.pdf
|chant1.wav       | statement_of_account.pdf

---

## Procedimentos para a obten√ß√£o das provas descobertas

Antes de iniciar qualquer procedimento inspecion√°mos cada ficheiro dado com o comando hexdump e strings.

Encontr√°mos artefactos relevantes para a investiga√ß√£o nos ficheiros que se seguem.

### üîç ticket.jpg

**Ferramenta**: `foremost`  
Extrai ficheiros escondidos dentro de outros ficheiros.
√â um programa que recupera ficheiros com base nos seus cabe√ßalhos, rodap√©s e estruturas de dados internas.


**Modo de extra√ß√£o**
```bash
foremost -i ticket.jpg -o Evidences/ticket

-i corresponde ao input file
-o corresponde output file
``` 

Ao executar este comando foi criada uma pasta com o nome ticket dentro da diretoria Evidences/ticket que cont√©m:

    > 2 sub pastas 
        > uma para as imagens com a extens√£o .jpg
        > outra para ficheiro com a extens√£o .pdf
    > 1 ficheiro audit.txt que cont√©m as informa√ß√µes dos ficheiros obtidos 

Ao executar este comando foi extra√≠do o ficheiro 00000154.pdf, que depois foi renomeado para club_statement.pdf e removida a diretoria Evidences/ticket
  
### üîç daft_punk.gif
 
**Ferramenta**: `exiftool`

L√™ os metadados de um ficheiro  
Ex:
+ Geolocaliza√ß√£o de uma imagem
+ Tamanho de um ficheiro

**Modo de extra√ß√£o**
```bash
exiftool -comment daft_punk.gif -b > Evidences/file.zip && unzip Evidences/file.zip

-[tag] d√° como output apenas a tag escolhida, neste caso "comment"
-b fornece o output em formato bin√°rio para garantir a formata√ß√£o
   quando fizer o redirecionamento (>) para um ficheiro 
&& unzip (extrai o .zip)
``` 
Ao executar este comando foi extra√≠do o ficheiro pdf James_Santos_profile.pdf


### üîç chants.zip
 
**Ferramenta**: `fcrackzip`  
Faz a extra√ß√£o de um zip protegido com password

**Modo de extra√ß√£o**
```bash
fcrackzip -u -D -p Tools/SNA_Lyrics_words.txt chants.zip

-u tenta extrair com a password da wordlist
-D seleciona a extra√ß√£o por wordlist
-p corresponde √† wordlist a usar na extra√ß√£o
``` 
A password do ficheiro **chants.zip** √© descoberta atrav√©s de uma wordlist criada com todas as palavras da m√∫sica **Seven Nation Army** dos **The White Stripes**. 

Foi criado o ficheiro **SNA_Lyrics_words.txt** na diretoria `Tools/` que cont√™m todas as palavra da m√∫sica uma palavra por linha do ficheiro.
Em alternativa podia ter sido usado o ficheiro **words.txt** da diretoria `Tools/` que cont√™m 479k palavras do alfabeto ingl√™s para crakear a password.

Usando qualquer um dos ficheiros acima mencionados descobrimos a password.

Ao fazer unzip obtemos dois ficheiros na diretoria `Evidences/chant2` e `Evidences/chant1.wav`. O ficheiro chant2 foi renomeado para internal_comunication.pdf

**Password** = `Wichita`

### üîç hbfs.wav

**Ferramenta**: `strings`  
Imprime a sequ√™ncia de caracteres printable de ficheiros.

**Inspe√ß√£o do ficheiro**
```bash
strings hbfs.wav
```
Ao inspecionarmos este ficheiro wav verific√°mos que a √∫ltima string era um hyperlink para a ferramenta `tool`, √∫til para
a descoberta de ficheiros escondidos em ficheiros wav.

**string** = `https://bit.ly/39jit4x`

**Ferramenta**: `tool`  
Ciber-Seguran√ßa Forense - Instituto Superior T√©cnico / Universidade Lisboa  
LSB steganography tool: hide files within least significant bits of mono (1 channel) wav sound files.  

```bash
./tool hide <wav_file> <payload_file> <n_lsb> [password]

<wav_file> o ficheiro wav onde esconder
<payload_file> o ficheiro a esconder
<n_lsb> o n√∫mero associado ao lsb onde a mensagem foi escondida
[password] (opcional) No caso de ser opcional a password √© "0"
```

### üîç Decode da tool

**Ferramenta**: `github.com/rocky/python-decompile3`  

Para originar o source code do execut√°vel tool, us√°mos a ferramenta decompile3.
O nome da tool foi alterado para tool.pyc e de seguida foi descompilado para um ficheiro tool.py

**Decode**
```bash
mv tool tool.pyc
decompyle3 tool.pyc > tool.py
```

Deste modo foi poss√≠vel analisar o source code da ferramenta tool.


### üîç Extra√ß√£o de payload de hbfs.wav

**Ferramenta**: `recoverWav.py` 

Sabemos que foi usada a tool para esconder um ficheiro pdf usando os parametros: n_lsb = 2[^3] e password = 2[^3].

[^3]: Sabemos que n_lsb = 2 e password = 2, atrav√©s de for√ßa bruta com o script **hbfsRecover.sh**.

Atrav√©s do script recoverWav.py recuper√°mos o ficheiro pdf escondido, executando o script recoverWav.py com os seguintes parametros:
```bash
python3 recoverWav.py recover hbfs.wav 2 2
```
Originou um ficheiro lsb2-2.txt
De seguida us√°mos a ferramenta `foremost` para extrair qualquer documento presente no ficheiro lsb2-2.txt, e encontr√°mos o ficheiro statement_of_account.pdf.

**Modo de extra√ß√£o**
```bash
python3 recoverWav.py recover hbfs.wav 2 2
mv lsb2-2.txt hbfs-lsb2-2.txt
foremost -i hbfs-lsb2-2.txt -o hbfs-lsb2-2
``` 


### üîç Extra√ß√£o de payload de chant1.wav

**Ferramenta**: `recoverWav.py` 

Sabemos que foi usada a tool para esconder um ficheiro pdf usando os parametros: n_lsb = 2[^4] e password = 4[^4].

[^4]: Sabemos que n_lsb = 2 e password = 4, atrav√©s de for√ßa bruta com o script **chant1Recover.sh**.

Atrav√©s do script recoverWav.py recuper√°mos o ficheiro pdf escondido, executando o script recoverWav.py com os seguintes parametros:
```bash
python3 recoverWav.py recover chant1.wav 2 4
```
Originou um ficheiro lsb2-4.txt
De seguida us√°mos a ferramenta `foremost` para extrair qualquer documento presente no ficheiro lsb2-4.txt, e encontr√°mos o ficheiro official_supporters_statement.pdf.

**Modo de extra√ß√£o**
```bash
python3 recoverWav.py recover chant1.wav 2 4
mv lsb2-4.txt chant1-lsb2-4.txt
foremost -i chant1-lsb2-4.txt -o chant1-lsb2-4
``` 

---

## Itens auxiliares

‚Ä¢ `generateEvidences.sh`
- Bash script que automatiza todo o processo de obten√ß√£o de segredos. Com apenas um comando √© poss√≠vel extrair o pdf do ficheiro ticket.jpg,
  o pdf James_Santos_profile.pdf do ficheiro daft_punk.gif, crackear o zip com a wordlist SNA_Lyrics_words.txt, fazer unzip do ficheiro chants.zip com a password descoberta, 
  e recuperar os ficheiros escondidos dentro dos ficheiros hbfs.wav e chant1.wav.
  Al√©m disso √© ainda poss√≠vel instalar as ferramentas necess√°rias para a obten√ß√£o das provas.
  
 **Modo de utiliza√ß√£o:** [^6] [^7]
  ```bash
  bash generateEvidences.sh <arg>
  bash generateEvidences.sh -y 
  bash generateEvidences.sh -n
  ```

‚Ä¢ `inspectFiles.sh`
- Bash script que automatiza o processo de inspe√ß√£o de ficheiros. Para cada ficheiro dado s√£o aplicados os comandos `hexdump` e `strings`
  e s√£o guardados os outputs nas respetivas diretorias `Evidences/HexdumpFiles/` e `Evidences/StringsFiles/`
  
  Para cada ficheiro s√£o executados os seguintes comandos:
  
  ```bash
  hexdump -C file > Evidences/HexdumpFiles/file_hexdump.txt
  
  Strings file > Evidences/StringFiles/file_strings.txt
  ```
 
  Deste modo, a inspe√ß√£o de ficheiros torna-se mais eficaz e organizada.
 
  **Modo de utiliza√ß√£o:**
  ```bash
  bash inspectFiles.sh
  ```
  
‚Ä¢ `crackChantsZip.py`
- Um script modelizado em Python que abre e extrai automaticamente o ficheiro **chants.zip** e o seu conte√∫do para a diretoria `Evidences/` usando a password[^5] guardada no ficheiro `Evidences/chantsZipPassword.txt`

  [^5]: A password foi descoberta atrav√©s da ferramenta `fcrackzip` e guardada no ficheiro `Evidences/chantsZipPassword.txt`

‚Ä¢ `recoverWav.py`
- Python Script usado para extrair os segredos dos ficheiros wav.
  
  **Modo de utiliza√ß√£o:**
  ```bash
  python3 recoverWav.py recover <wav_file> <n_lsb> [password]
  ```

‚Ä¢ `tool`
- Ciber-Seguran√ßa Forense - Instituto Superior T√©cnico / Universidade Lisboa  
  LSB steganography tool: hide files within least significant bits of mono (1 channel) wav sound files.
  
‚Ä¢ `tool.py`
- Source code da tool

‚Ä¢ `hbfsRecover.sh`
- Bash script que recupera os ficheiros escondidos de hbfs.wav. Testa com for√ßa bruta todos os n_lsb e passwords poss√≠veis de modo a extra√≠r os ficheiros escondidos.
  O bash corre todas as combina√ß√µes de n_lsb e passwords poss√≠veis no script recoverWav.py
  
‚Ä¢ `chants1Recover.sh`
- Bash script que recupera os ficheiros escondidos de chant1.wav. Testa com for√ßa bruta todos os n_lsb e passwords poss√≠veis de modo a extra√≠r os ficheiros escondidos.
  O bash corre todas as combina√ß√µes de n_lsb e passwords poss√≠veis no script recoverWav.py

‚Ä¢ `words.txt`
- Wordlist que cont√™m 479k palavras do alfabeto ingl√™s.

‚Ä¢ `SNA_Lyrics_words.txt`
- Wordlist que cont√™m todas as palavra da m√∫sica **Seven Nation Army** dos **The White Stripes** uma palavra por linha do ficheiro.

---

## Automatiza√ß√£o de extra√ß√£o de provas e inspe√ß√£o de ficheiros

**Nota**: Para correr os ficheiros seguintes de automatiza√ß√£o, √© necess√°rio que a estrutura do projeto seja igual √° mencionada em `Visualiza√ß√£o gr√°fica do ambiente de investiga√ß√£o`. Ou seja, √© necess√°rio que os ficheiros dados estejam presentes.

De modo a automaticamente extrair todos os segredos e evid√™ncias dos ficheiros dados basta correr o seguinte bash script `generateEvidences.sh`.

Correr na diretoria `Tools/`.

 **Modo de utiliza√ß√£o:** [^6] [^7]
        
  ```bash
  bash generateEvidences.sh <arg>
  bash generateEvidences.sh -y 
  bash generateEvidences.sh -n 
  ```
  
 [^6]: -y instala as ferramentas e extrai todas as provas para a diretoria `Evidences/`
 [^7]: -n Assume que j√° t√™m as ferramentas instaladas e extrai todas as provas para a diretoria `Evidences/`
        
 Ap√≥s a execu√ß√£o deste comando, todas as evid√™ncias e provas ser√£o armazenadas na diretoria `Evidences/`
 
 Para inspecionar automaticamente todos os ficheiros dados de uma s√≥ vez,  basta correr o seguinte bash script `inspectFiles.sh`
 
 Correr na diretoria `Tools/`.
 
  **Modo de utiliza√ß√£o:**
  ```bash
  bash inspectFiles.sh
  ```
  Ap√≥s a execu√ß√£o deste comando, para cada ficheiro dado s√£o aplicados os comandos `hexdump` e `strings`
  e guardados os outputs nas respetivas diretorias `Evidences/HexdumpFiles/` e `Evidences/StringsFiles/`.
  
---
